<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Todo List</title>
<link rel="manifest" href="manifest.json">

<style>
/* ---------- BODY ---------- */
body {
    font-family: Georgia, 'Times New Roman', Times, serif;
    background-color: #ffffff; /* default light background for mobile */
    color: #000000;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.3s;
}

/* ---------- CONTAINER ---------- */
.todo-container {
    width: 500px;
    padding: 20px;
    border-radius: 12px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    backdrop-filter: blur(6px);
    transition: 0.3s;
}

/* ---------- HEADER ---------- */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

h2 { margin: 0; }

/* ---------- SETTINGS ---------- */
.settings { position: relative; }

.gear-btn {
    background: transparent;
    font-size: 20px;
    cursor: pointer;
    border: none;
}

.settings-panel {
    display: none;
    position: absolute;
    right: 0;
    top: 30px;
    background: white;
    padding: 10px;
    border-radius: 8px;
    width: 120px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}

.settings-panel button {
    width: 100%;
    margin-top: 5px;
    cursor: pointer;
}

/* ---------- INPUT ---------- */
.input-area {
    display: flex;
    gap: 5px;
    margin-top: 15px;
}

input {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

.add-btn {
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
}

/* ---------- LIST ---------- */
ul {
    list-style: none;
    padding: 0;
    margin-top: 15px;
}

li {
    background: #f5f5f5;
    margin-bottom: 8px;
    padding: 8px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

li.completed span {
    text-decoration: line-through;
    color: gray;
}

.actions button {
    margin-left: 5px;
    cursor: pointer;
}

.done-btn {
    background: #2196F3;
    color: white;
    border: none;
    padding: 5px 8px;
    border-radius: 5px;
}

.delete-btn {
    background: #f44336;
    color: white;
    border: none;
    padding: 5px 8px;
    border-radius: 5px;
}

/* ---------- DARK MODE ---------- */
body.dark {
    background-color: #121212; /* mobile fallback for dark theme */
    color: #ffffff;
}

body.dark .todo-container {
    background: rgba(97, 95, 95, 0.85);
}

body.dark li { background: #2a2a2a; }
body.dark input {
    background: #333;
    color: white;
    border: 1px solid #555;
}
body.dark .settings-panel { background: #2a2a2a; }
body.dark .settings-panel button { background: #444; color: white; }

/* ---------- DESKTOP BACKGROUND IMAGES ---------- */
@media screen and (min-width: 768px) {
    body { 
        background-image: url("light.jpg");
        background-repeat: repeat;
        background-size: 300px;
        background-position: top left;
    }

    body.dark {
        background-image: url("dark.jpg");
        background-repeat: repeat;
        background-size: 300px;
        background-position: top left;
    }
}
</style>
</head>

<body>
<div class="todo-container">
    <div class="header">
        <h2>üìù Todo List</h2>

        <div class="settings">
            <button class="gear-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
            <div class="settings-panel" id="settingsPanel">
                <strong>Theme</strong>
                <button onclick="setTheme('light')">‚òÄÔ∏è Light</button>
                <button onclick="setTheme('dark')">üåô Dark</button>
            </div>
        </div>
    </div>

    <div class="input-area">
        <input id="inp" placeholder="Enter a task" onkeydown="handleEnter(event)">
        <button class="add-btn" onclick="addTodo()">Add</button>
    </div>

    <ul id="ul_id"></ul>
</div>

<script>
const inp = document.getElementById("inp");
const ul = document.getElementById("ul_id");

/* ---------- LOAD ---------- */
window.onload = function () {
    loadTodos();
    loadTheme();
};

/* ---------- ADD TODO ---------- */
function addTodo() {
    const text = inp.value.trim();
    if (text === "") return alert("Enter a task");

    createTodo(text, false);
    saveTodos();
    inp.value = "";
}

/* ---------- CREATE TODO ---------- */
function createTodo(text, completed) {
    const li = document.createElement("li");
    if (completed) li.classList.add("completed");

    li.innerHTML = `
        <span>${text}</span>
        <div class="actions">
            <button class="done-btn" onclick="toggleDone(event)">
                ${completed ? "Undo" : "Done"}
            </button>
            <button class="delete-btn" onclick="deleteTodo(event)">Delete</button>
        </div>
    `;
    ul.append(li);
}

/* ---------- DONE / UNDO ---------- */
function toggleDone(event) {
    const li = event.target.closest("li");
    const btn = event.target;

    if (li.classList.contains("completed")) {
        li.classList.remove("completed");
        btn.innerText = "Done";
        ul.prepend(li);
    } else {
        li.classList.add("completed");
        btn.innerText = "Undo";
        ul.append(li);
    }
    saveTodos();
}

/* ---------- DELETE ---------- */
function deleteTodo(event) {
    event.target.closest("li").remove();
    saveTodos();
}

/* ---------- ENTER KEY ---------- */
function handleEnter(e) {
    if (e.key === "Enter") addTodo();
}

/* ---------- STORAGE ---------- */
function saveTodos() {
    let todos = [];
    document.querySelectorAll("li").forEach(li => {
        todos.push({
            text: li.querySelector("span").innerText,
            completed: li.classList.contains("completed")
        });
    });
    localStorage.setItem("todos", JSON.stringify(todos));
}

function loadTodos() {
    let data = localStorage.getItem("todos");
    if (!data) return;
    JSON.parse(data).forEach(todo => {
        createTodo(todo.text, todo.completed);
    });
}

/* ---------- SETTINGS ---------- */
function toggleSettings() {
    const panel = document.getElementById("settingsPanel");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
}

function setTheme(mode) {
    if (mode === "dark") document.body.classList.add("dark");
    else document.body.classList.remove("dark");

    localStorage.setItem("theme", mode);
    document.getElementById("settingsPanel").style.display = "none";
}

function loadTheme() {
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
    }
}

/* ---------- CLOSE SETTINGS ON OUTSIDE CLICK ---------- */
document.addEventListener("click", e => {
    if (!e.target.closest(".settings")) {
        document.getElementById("settingsPanel").style.display = "none";
    }
});

/* ---------- SERVICE WORKER ---------- */
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker Registered"))
    .catch(err => console.log("SW registration failed", err));
}
</script>
</body>
</html>
